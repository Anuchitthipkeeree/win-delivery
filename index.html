<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Win Delivery - Food Delivery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mt-4">
    <h1 class="mb-4">Win Delivery - ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
    <div id="menu-section">
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...</p>
    </div>
    <button class="btn btn-warning mt-3" onclick="showCart()">‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ üõí</button>
  </div>

<script>
const MENU_SHEET_ID = '1HCxb0FBBbeHfaa8Dg3OnQZ4xqEEqEu1Rx2g_6kraJBA';  // ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô Google Sheets ‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzkAatyOegEpL2vvVdTuDBZf1scnIjhmaleZ2EJFy6wGf57sRr6SlAble4O1d9ruLIVmA/exec';  // Web App URL ‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß

let menuData = [];
let cart = [];

async function loadMenu() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${MENU_SHEET_ID}/values/Menu?key=YOUR_GOOGLE_API_KEY`; 
  // **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Google API Key ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà YOUR_GOOGLE_API_KEY
  
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (!data.values) {
      document.getElementById('menu-section').innerHTML = '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π</p>';
      return;
    }

    // data.values[0] = header row
    menuData = data.values.slice(1); // ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
    renderMenu();

  } catch (error) {
    document.getElementById('menu-section').innerHTML = `<p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
  }
}

function renderMenu() {
  const section = document.getElementById("menu-section");
  section.innerHTML = '';
  if(menuData.length === 0){
    section.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>';
    return;
  }
  menuData.forEach(row => {
    const [shop, menuName, price] = row;
    const card = document.createElement('div');
    card.className = "card mb-3";
    card.innerHTML = `
      <div class="card-body">
        <h5 class="card-title">${menuName}</h5>
        <p class="card-text">‡∏£‡πâ‡∏≤‡∏ô: ${shop}</p>
        <p class="card-text">‡∏£‡∏≤‡∏Ñ‡∏≤: ${price} ‡∏ö‡∏≤‡∏ó</p>
        <button class="btn btn-success" onclick="addToCart('${menuName}', ${price}, '${shop}')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
      </div>
    `;
    section.appendChild(card);
  });
}

function addToCart(menuItem, price, shop) {
  const found = cart.find(item => item.menu === menuItem && item.shop === shop);
  if (found) {
    found.qty += 1;
  } else {
    cart.push({ shop, menu: menuItem, price: parseFloat(price), qty: 1 });
  }
  alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
}

function showCart() {
  const section = document.getElementById("menu-section");
  section.innerHTML = "<h3>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>";
  if (cart.length === 0) {
    section.innerHTML += "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>";
    return;
  }

  let total = 0;
  section.innerHTML += `<table class="table"><thead><tr>
      <th>‡∏£‡πâ‡∏≤‡∏ô</th><th>‡πÄ‡∏°‡∏ô‡∏π</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏ß‡∏°</th></tr></thead><tbody>`;

  cart.forEach(item => {
    const sum = item.qty * item.price;
    total += sum;
    section.innerHTML += `<tr><td>${item.shop}</td><td>${item.menu}</td><td>${item.qty}</td><td>${sum}‡∏ø</td></tr>`;
  });

  section.innerHTML += `</tbody></table>
    <p><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó</strong></p>
    <p>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: <input id="customerPhone" class="form-control mb-2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"></p>
    <p>üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà): <input id="customerLocation" class="form-control mb-2" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î"></p>
    <button class="btn btn-primary" onclick="submitOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    <button class="btn btn-secondary mt-2" onclick="renderMenu()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</button>`;
}

async function submitOrder() {
  const phone = document.getElementById("customerPhone").value.trim();
  const location = document.getElementById("customerLocation").value.trim();
  if (!phone || !location) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
    return;
  }
  if(cart.length === 0){
    alert("‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡∏™‡∏±‡πà‡∏á");
    return;
  }

  const payload = {
    phone,
    location,
    orders: cart
  };

  try {
    const response = await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "application/json" }
    });
    if (response.ok) {
      alert("‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
      cart = [];
      renderMenu();
    } else {
      alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå");
    }
  } catch (error) {
    alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
window.onload = loadMenu;
</script>
</body>
</html>
