<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>แผนที่ - Rider Map | Win Delivery</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #1877f2;
      --background: #f0f2f5;
      --card: #fff;
      --text: #050505;
      --muted: #65676b;
      --accent: #ff3b30;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }

    body,
    html {
      height: 100%;
      background-color: var(--background);
      color: var(--text);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header {
      background-color: var(--primary);
      color: #fff;
      padding: 1rem;
      font-weight: 600;
      font-size: 1.4rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
      position: relative;
      flex-shrink: 0;
    }

    .back-button {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
    }

    #map {
      flex-grow: 1;
      width: 100%;
      height: 100%;
      min-height: 300px;
    }

    #locationError {
      padding: 0.5rem 1rem;
      text-align: center;
      color: var(--accent);
      font-weight: 600;
      background: #ffe6e6;
      display: none;
      flex-shrink: 0;
    }

    footer {
      display: flex;
      justify-content: space-around;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 0.4rem 0;
      box-shadow: 0 -2px 5px rgb(0 0 0 / 0.1);
      flex-shrink: 0;
    }

    footer a {
      text-decoration: none;
      color: var(--muted);
      font-size: 0.75rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 56px;
      user-select: none;
    }

    footer a img.icon {
      width: 28px;
      height: 28px;
      margin-bottom: 3px;
      object-fit: contain;
    }

    footer a.active,
    footer a:hover {
      color: var(--primary);
      font-weight: 600;
    }
  </style>
</head>

<body>
  <header>
    <button class="back-button" onclick="goBack()" aria-label="กลับ">
      &#8592;
    </button>
    แผนที่จัดส่ง
  </header>

  <div id="locationError" role="alert"></div>
  <div id="map" role="region" aria-label="แผนที่แสดงตำแหน่งไรเดอร์และจุดจัดส่ง"></div>

  <footer>
    <a href="index.html" aria-label="หน้าหลัก">
      <img class="icon" src="https://cdn-icons-png.flaticon.com/512/1946/1946433.png" alt="หน้าหลัก" />
      หน้าหลัก
    </a>
    <a href="rider-dashboard.html" aria-label="แดชบอร์ดไรเดอร์">
      <img class="icon" src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" alt="แดชบอร์ด" />
      แดชบอร์ด
    </a>
    <a href="update.html" aria-label="อัปเดตสถานะ">
      <img class="icon" src="https://cdn-icons-png.flaticon.com/512/992/992700.png" alt="อัปเดต" />
      อัปเดต
    </a>
    <a href="chat.html" aria-label="แชต">
      <img class="icon" src="https://cdn-icons-png.flaticon.com/512/2462/2462719.png" alt="แชต" />
      แชต
    </a>
    <a href="map.html" class="active" aria-current="page" aria-label="แผนที่">
      <img class="icon" src="https://cdn-icons-png.flaticon.com/512/252/252025.png" alt="แผนที่" />
      แผนที่
    </a>
  </footer>

  <script
    async
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
  ></script>
  <script>
    function goBack() {
      window.history.back();
    }

    let map, riderMarker, customerMarker, routePath;

    function initMap() {
      const defaultPosition = { lat: 13.7563, lng: 100.5018 };

      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultPosition,
        zoom: 12,
        gestureHandling: "greedy",
      });

      const riderIcon = {
        url: "https://cdn-icons-png.flaticon.com/512/1946/1946429.png",
        scaledSize: new google.maps.Size(40, 40),
      };

      const customerIcon = {
        url: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
        scaledSize: new google.maps.Size(40, 40),
      };

      const customerPosition = { lat: 13.7463, lng: 100.5318 };
      customerMarker = new google.maps.Marker({
        position: customerPosition,
        map: map,
        title: "จุดส่งลูกค้า",
        icon: customerIcon,
      });

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const riderPos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            if (!riderMarker) {
              riderMarker = new google.maps.Marker({
                position: riderPos,
                map: map,
                title: "ตำแหน่งไรเดอร์ของคุณ",
                icon: riderIcon,
              });
            } else {
              riderMarker.setPosition(riderPos);
            }

            if (routePath) {
              routePath.setMap(null);
            }

            routePath = new google.maps.Polyline({
              path: [riderPos, customerPosition],
              geodesic: true,
              strokeColor: "#1877f2",
              strokeOpacity: 0.8,
              strokeWeight: 4,
            });
            routePath.setMap(map);

            const bounds = new google.maps.LatLngBounds();
            bounds.extend(riderPos);
            bounds.extend(customerPosition);
            map.fitBounds(bounds);

            document.getElementById("locationError").style.display = "none";
          },
          (error) => {
            const errorDiv = document.getElementById("locationError");
            errorDiv.textContent =
              "ไม่สามารถระบุตำแหน่งปัจจุบันของคุณได้ กรุณาเปิด GPS และอนุญาตเบราว์เซอร์";
            errorDiv.style.display = "block";

            map.setCenter(defaultPosition);
            map.setZoom(12);
          }
        );
      } else {
        const errorDiv = document.getElementById("locationError");
        errorDiv.textContent = "เบราว์เซอร์ของคุณไม่รองรับการระบุตำแหน่ง";
        errorDiv.style.display = "block";

        map.setCenter(defaultPosition);
        map.setZoom(12);
      }
    }
  </script>
</body>

</html>
