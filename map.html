<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>แผนที่ - Rider Map | Win Delivery</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --primary: #1877f2;
      --background: #f0f2f5;
      --card: #fff;
      --text: #050505;
      --muted: #65676b;
      --accent: #ff3b30;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }

    body,
    html {
      height: 100%;
      background-color: var(--background);
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: var(--primary);
      color: #fff;
      padding: 1rem;
      font-weight: 600;
      font-size: 1.4rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
      position: relative;
    }

    .back-button {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
    }

    #map {
      flex-grow: 1;
      height: 100%;
      width: 100%;
    }

    footer {
      display: flex;
      justify-content: space-around;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 0.5rem 0;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
    }

    footer a {
      text-decoration: none;
      color: var(--muted);
      font-size: 0.75rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: color 0.3s;
      width: 20%;
    }

    footer a i {
      background-color: #f2f2f2;
      border-radius: 50%;
      padding: 0.5rem;
      font-size: 1.2rem;
      margin-bottom: 0.25rem;
    }

    footer a.active,
    footer a:hover {
      color: var(--primary);
      font-weight: 600;
    }

    /* ข้อความแจ้งเมื่อหา GPS ไม่ได้ */
    #locationError {
      padding: 1rem;
      text-align: center;
      color: var(--accent);
      font-weight: 600;
      background: #ffe6e6;
      display: none;
    }
  </style>

  <!-- ใช้ Font Awesome สำหรับไอคอน -->
  <script
    src="https://kit.fontawesome.com/a076d05399.js"
    crossorigin="anonymous"
    defer
  ></script>

  <!-- Google Maps API -->
  <script
    async
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
  ></script>
</head>

<body>
  <header>
    <button class="back-button" onclick="goBack()" aria-label="กลับ"><i class="fas fa-arrow-left"></i></button>
    แผนที่จัดส่ง
  </header>

  <div id="locationError" role="alert"></div>
  <div id="map" role="region" aria-label="แผนที่แสดงตำแหน่งไรเดอร์และจุดจัดส่ง"></div>

  <footer>
    <a href="index.html" aria-label="หน้าหลัก">
      <i class="fas fa-home"></i>
      <span>หน้าหลัก</span>
    </a>
    <a href="rider-dashboard.html" aria-label="แดชบอร์ดไรเดอร์">
      <i class="fas fa-tachometer-alt"></i>
      <span>แดชบอร์ด</span>
    </a>
    <a href="update.html" aria-label="อัปเดตสถานะ">
      <i class="fas fa-edit"></i>
      <span>อัปเดต</span>
    </a>
    <a href="chat.html" aria-label="แชต">
      <i class="fas fa-comment-dots"></i>
      <span>แชต</span>
    </a>
    <a href="map.html" class="active" aria-current="page" aria-label="แผนที่">
      <i class="fas fa-map-marker-alt"></i>
      <span>แผนที่</span>
    </a>
  </footer>

  <script>
    function goBack() {
      window.history.back();
    }

    let map, riderMarker, customerMarker, routePath;

    function initMap() {
      // สร้างแผนที่ที่ศูนย์กลางไว้ก่อน (กรุงเทพ)
      const defaultPosition = { lat: 13.7563, lng: 100.5018 };

      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultPosition,
        zoom: 12,
      });

      // ไอคอน Rider
      const riderIcon = {
        url: "https://cdn-icons-png.flaticon.com/512/1946/1946429.png",
        scaledSize: new google.maps.Size(40, 40),
      };

      // ไอคอน บ้านลูกค้า
      const customerIcon = {
        url: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
        scaledSize: new google.maps.Size(40, 40),
      };

      // Marker ลูกค้า ตำแหน่งตัวอย่าง
      const customerPosition = { lat: 13.7463, lng: 100.5318 };
      customerMarker = new google.maps.Marker({
        position: customerPosition,
        map: map,
        title: "จุดส่งลูกค้า",
        icon: customerIcon,
      });

      // ขอสิทธิ์ดึงตำแหน่ง GPS ของไรเดอร์
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const riderPos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            // วาง marker ไรเดอร์ตำแหน่งจริง
            if (!riderMarker) {
              riderMarker = new google.maps.Marker({
                position: riderPos,
                map: map,
                title: "ตำแหน่งไรเดอร์ของคุณ",
                icon: riderIcon,
              });
            } else {
              riderMarker.setPosition(riderPos);
            }

            // วาดเส้นทางจากไรเดอร์ไปยังลูกค้า
            if (routePath) {
              routePath.setMap(null); // เคลียร์เส้นเดิมก่อน
            }

            routePath = new google.maps.Polyline({
              path: [riderPos, customerPosition],
              geodesic: true,
              strokeColor: "#1877f2",
              strokeOpacity: 0.8,
              strokeWeight: 4,
            });
            routePath.setMap(map);

            // ซูมและจัดตำแหน่งกลางเพื่อให้เห็นทั้ง 2 จุด
            const bounds = new google.maps.LatLngBounds();
            bounds.extend(riderPos);
            bounds.extend(customerPosition);
            map.fitBounds(bounds);

            // ซ่อนข้อความ error
            document.getElementById("locationError").style.display = "none";
          },
          (error) => {
            // กรณีไม่อนุญาตหรือเกิดข้อผิดพลาด
            const errorDiv = document.getElementById("locationError");
            errorDiv.textContent =
              "ไม่สามารถระบุตำแหน่งปัจจุบันของคุณได้ กรุณาเปิด GPS และอนุญาตเบราว์เซอร์";
            errorDiv.style.display = "block";

            // แสดงตำแหน่ง default และ customer
            map.setCenter(defaultPosition);
            map.setZoom(12);
          }
        );
      } else {
        // เบราว์เซอร์ไม่รองรับ GPS
        const errorDiv = document.getElementById("locationError");
        errorDiv.textContent = "เบราว์เซอร์ของคุณไม่รองรับการระบุตำแหน่ง";
        errorDiv.style.display = "block";

        map.setCenter(defaultPosition);
        map.setZoom(12);
      }
    }
  </script>
</body>

</html>
